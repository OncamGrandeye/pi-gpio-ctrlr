<html ng-app="app">
<head>
  <title>GPIO Rasberry Pi Control Server</title>
  <meta name="viewport" content="width=device-width">
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />

<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="https://bootswatch.com/4/united/bootstrap.min.css" media="screen">
<!--
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Libre+Baskerfille:regular,italic,700&subset=latin%2Clatin-ext" />
<link rel="stylesheet" href="https://www.oncamgrandeye.com/wp-content/cache/min/1/14fc188ab5c1fe6f729db5cdaaa83dbf.css" data-minify="1" />
-->

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.9.0/ui-bootstrap-tpls.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.min.js"></script>

<!-- include socket.io client side script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script> 

<script src="js/app.js"></script>

<style type="text/css">
  
  .hand {
	cursor: pointer;
  }
  
  .icon {
	text-shadow: 3px 3px 3px #ccc;
  }	
	
  .gpio-grid {
    display: grid;
    grid-template-columns: repeat(2, 175px);
    grid-gap: 2px;
  }

  .gpio-cell {
    height: 25px;
  }
 

  .btn-3V3 {
    background:#f44336;
    color: #ffffff;
  }

  .btn-5V {
    background:#f44336;
    color: #ffffff;
  }

  .btn-GPIO {
    background-color: #f0e68c;
    border-color:  #f0e68c;
  }
  
  .btn-GPIO:disabled, btn-GPIO.disabled {
    opacity: 1;
    color: 0;
    background-color: #f0e68c;
    border-color:  #f0e68c;
  }

  .btn-GPIO:enabled {
    font-weight: bold;
  }

  .btn-GPIO:hover:enabled {
    background-color: #f0e68c;
    border-color:  #f0e68c;
    -webkit-box-shadow: 0 0 0 0.2rem rgba(233, 84, 32, 0.5);
            box-shadow: 0 0 0 0.2rem rgba(233, 84, 32, 0.5);
  }
  
  .btn-GPIO:focus, btn-GPIO.focus {
    -webkit-box-shadow: 0 0 0 0.2rem rgba(233, 84, 32, 0.5);
            box-shadow: 0 0 0 0.2rem rgba(233, 84, 32, 0.5);
  }
  
  .btn-I2C {
    background: #4caf50;
    color: #ffffff;
  }

  .btn-SPI {
    background: #ff9800;
  }

  .btn-UART {
    background: #87ceeb;
  }

  .btn-GND {
    background: #616161;
    color: #ffffff;
  }

  .btn-DNC {
    background: #000000;
    color: #ffffff;
  }

  .pin-inactive {
    color: #ff4040;
  }

  .pin-active {
    color: #03a711;
  }
  
</style>

<!--
<script>
var _socket = io();

window.addEventListener('load', function() {
  // When the page loads...
  // Here is where the inputs are iterated...
  // Handlers for the onclick stuff... yada yada yada
  var box = document.getElementById('pin4');
  box.addEventListener('change', function() {
    _socket.emit('state', {Id: 4, Action: this.checked ? 'close' : 'open'});
  });
});

socket.on('status', function(data) {
  var newState = data.State == 'closed';
  document.getElementById('pin4').checked = newState;
  _socket.emit('state', {Id: 4, Action: newState ? 'close' : 'open' });
});

</script>
-->

<script type="text/ng-template" id="ioctrl.htm">
  <div ng-show="pins.length === 0">
    <p align="center">
      <i class="fa fa-spinner fa-spin fa-5x"></i>
    </p>
    <p align="center">Loading PIN Configuration</p>
  </div> 
  <div ng-show="pins.length > 0">  
    <div class="panel panel-default">
      <br>
      <div class="panel-body">
  
        <!--<p><input type="checkbox" id="pin4">Test pin 4</p>-->
        <div class="gpio-grid">
          <div class="col-xs-6" ng-repeat="pin in pins" gpio-pin></div>
        </div>
      
        <div class="row">
          <div class="col-md-12">
            <div ng-controller="AlertCtrl">
              <alert ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">
                  <i class="fa fa-warning"></i> {{alert.msg}}
              </alert>
            </div>
          </div>     
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="digital-input.htm">
</script>

<script type="text/ng-template" id="gpio-pin.htm">
  <div class="panel panel-default">
    <div class="panel-body" vertical-align="center">

        <button class="btn btn-pin btn-{{pin.Type}} btn btn-block"
               type="button" 
               ng-class="{'disabled':getGPIO(pin).relay === false}"
               ng-disabled="getGPIO(pin).relay === false"
               ng-click="getGPIO(pin).action()">
              
               <span class="pull-left">{{getGPIO(pin).text}}</span>
                <i class="fa fa-power-off fa-1x pull-right"
                 ng-class="{'pin-inactive':!getGPIO(pin).isActive, 'pin-active':getGPIO(pin).isActive}"
                 ng-show="pin.Type === 'GPIO'">
                </i>          
        </button>
    </div>
  </div>
</script>

<script type="text/ng-template" id="config.htm">
  <div ng-show="pins.length === 0">
    <p align="center">
      <i class="fa fa-spinner fa-spin fa-5x"></i>
    </p>
    <p align="center">Loading PIN Mappings...</p>
  </div> 
  <div ng-show="pins.length > 0">
    <div class="panel panel-default">
      <br>
      <div class="panel-body">
        <form role="form">
          <div class="form-group">
            <div class="row" ng-repeat="key in pins">
              <div class="col-sm-1"><label class="col-form-label col-form-label-sm">{{key.Type}}-{{key.Id}}</label></div>
              <div class="col-sm-3"><input class="form-control form-control-sm" id="name" placeholder="{{key.Type}}-{{key.Id}}" ng-model="key.Text" ng-disabled="key.Type !== 'GPIO'"></div>
              
              <div class="col-sm-4"><select class="form-control form-control-sm" id="mode" placeholder="Input (Relay Monitor)" ng-model="key.Mode" ng-disabled="key.Type !== 'GPIO'" ng-show="key.Type === 'GPIO">
                        <option value="OUTPUT" selected>Output (Trigger Input)</option>
                        <option value="INPUT">Input (Relay Monitor)</option>
                        <option value="SERVO">Servo (Trigger Motion)</option>
                      </select></div>
                    </div>
                    
              <div class="col-sm-4"></div>
            </div>
          </div>
        </form>
        <div class="form-group">
          <button type="submit" class="btn btn-primary" ng-click="setGpioConfig()">Apply</button>
        </div>
      </div>		
    </div>
  </div>
</script>

</head>



<body>
    
     
  <nav class="navbar navbar-expand navbar-dark bg-primary">
    <a class="navbar-brand" href="#">Raspberry Pi GPIO</a>
    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation" style="">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-collapse collapse" id="navbarColor01" style="">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Controller <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#config">Configuration</a>
        </li>
      </ul>
    </div>
  </nav>   
      
  <div class="container">
    <!-- View area (Controller/Settings) -->
    <div ng-view></div>
   
    <div ng-controller="navctrl">
      <p class="text-center"><small>{{organization}}  Footer text placeholder.</small></p>
    </div>
  </div>
  
</body>
</html>
